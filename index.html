<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Git</title>

		<link rel="stylesheet" href="reveal-js/css/reveal.css">
		<link rel="stylesheet" href="reveal-js/css/theme/simple.css">
		<link rel="stylesheet" href="theme/theme.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="reveal-js/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Git</h1>
					<p><a href="https://xkcd.com/1597/"><img src="images/git_2x.png" height="480" alt="" /></a></p>
				</section>

				<section>
					<h2>Linus’ Quest for a<br />Source Control Management System</h2>

					<blockquote class="fragment">
						“If you’re not distributed, you are not worth using”
					</blockquote>
					<blockquote class="fragment">
						“If you perform badly, you are not worth using”
					</blockquote>
					<blockquote class="fragment">
						“And if you cannot guarantee that the stuff I put into an SCM comes out exactly the same, you are not worth using”
					</blockquote>
					<p class="fragment">“Quite frankly, that pretty much took care of everything out there”</p>
					<p class="fragment">“The end result was I decided I can write something better than anything out there in two weeks”</p>
				</section>

				<section>
					<h2>Git</h2>
					<ul>
						<li>Distributed</li>
						<li>Performant</li>
						<li>Trustworthy</li>
						<li class="fragment">Content tracking system</li>
						<li class="fragment">Supports branching and merging with ease<br /><span class="fragment">(keeping the information in a graph)</span></li>
						<li class="fragment">Relatively easy to build clean history</li>
						<li class="fragment">Supports many different workflows</li>
					</ul>

					<blockquote class="fragment">“If you are doing something really fast people start using it differently”</blockquote>
				</section>

				<section>
					<h2>Distribution</h2>
					<p><img src="images/distributed.png" alt="" />
				</section>

				<section>
					<h2>Distribution</h2>
					<ul>
						<li>Everyone has a copy of the entire repository<br />– everything they need is on their machine</li>
						<li class="fragment">No single place is more important than any other<br />– some repos can be “special” only formally<br />(or socially, within a network of trust)</li>
						<li class="fragment">Everyone works freely in his/her own repository<br />– and they can do anything in it</li>
						<li class="fragment">Making changes without worries<br />– you can always go back, it’s not public before <code>push</code></li>
						<li class="fragment">Every branch is a version/a fork</li>
						<li class="fragment">Performance, no complicated access management,<br />offline work, ...</li>
						<li class="fragment">Especially helpful for <span class="details">(big)</span> groups at<br />various locations and open source teams</li>
					</ul>
				</section>

				<section>
					<section>
						<h2>Distributed Workflows</h2>
					</section>

					<section>
						<h2>Linux workflow</h2>
						<p><img src="images/18333fig0503-tn.png" alt="" />
					</section>

					<section>
						<h2>Centralized workflow</h2>
						<p><img src="images/18333fig0501-tn.png" alt="" />
					</section>

					<section>
						<h2>“Decentralized but centralized”</h2>
						<p><img src="images/centr-decentr.png" alt="" />
					</section>

					<section>
						<h2>Integration-Manager workflow</h2>
						<p><img src="images/18333fig0502-tn.png" alt="" />
					</section>
				</section>

				<section>
					<h2>What Will We Learn About?</h2>

					<ul>
						<li class="fragment">The philosophy of git</li>
						<li class="fragment">Git internals and how they come together</li>
						<li class="fragment">Git "externals"
							<ul>
								<li class="fragment">Showing/Analysing repository content</li>
								<li class="fragment">Managing all the parts of the repository</li>
								<li class="fragment">Creating and manipulating commits & content</li>
								<li class="fragment">Merging and conflicts resolution</li>
							</ul>
						</li>
						<li class="fragment">Remote repositories</li>
						<li class="fragment">Building clean history</li>
						<li class="fragment">Some fun tools – reflog, bisect, stash, etc</li>
						<li class="fragment">Not to be afraid to do something (as there is always a way back)</li>
						<li class="fragment">Good practices</li>
						<li class="fragment">Workflows – how to work together as a team</li>
					</ul>
				</section>

				<section>
					<h2>Git Repository</h2>
					<ul>
						<li>Objects</li>
						<li>Index</li>
						<li>Working directory</li>
						<li>Refs</li>
					</ul>
				</section>

				<section>
					<h2>Objects</h2>
				</section>

				<section>
					<h2>Immutable Data Structures</h2>

					<p class="fragment">They change the way we program</p>
					<p class="fragment">Especially useful for distributed systems</p>
				</section>

				<section>
					<h2>Objects</h2>

					<ul class="fragment">
						<li>Blobs</li>
						<li>Trees</li>
						<li>Commits</li>
						<li>Tags</li>
					</ul>

					<p class="fragment">
						Every object is immutable<br />
						<span class="fragment">and identified by the SHA-1 hash of its content</span>
					</p>
				</section>

				<section>
					<h2>Blob</h2>
					<ul>
						<li>A regular file</li>
						<li>Only its content, without its filename or other metadata</li>
						<li>Every update on a file is a fully new blob (git doesn't record file-specific history)</li>
					</ul>
				</section>

				<section>
					<h2>Tree</h2>
					<ul>
						<li>A level of directory information</li>
						<li>A collection of records that points to a (sub)tree, a blob or a submodule commit</li>
						<li>Stores the metadata — filename, file permissions</li>
					</ul>
				</section>

				<section>
					<h2>Tree</h2>
					<pre><code class="shell">$ git cat-file -p 755a33e4667848c71d2ebde4bf1cd8eb2a36a1dd
100644 blob 1620d5c9c4d3102beb552bc2db496482924386ea    .gitignore
100644 blob ddbcba4eaa1b925df086b3cff71104a1ff8c7a84    .gitlab-ci.yml
100644 blob 4be17156977c770957b6cb883b817108296ee2f9    Dockerfile
100644 blob a2071fb01a5cbf65c54bb612ef34a37c8da2d30b    README.md
100755 blob ed0ab79cbb584975a4611304a7a7acbc437f294f    build-manifests.sh
100644 blob d03cd079f4ee07ff12f96fcd43c07e98daa904f1    build.sbt
040000 tree 9c0dd50454bf7d9b564b6dce3ff2955ef6fc2e29    manifests
040000 tree 4671c32b75507ef0fcb13680bdf47cba159f1e87    project
100755 blob 0d950f32340f72a3b0bd4d0ce9ce273821f3d910    publish-manifests-bundle.sh
040000 tree 45d3bf59ab21d045f636548aea929b705207d759    src</code></pre>
				</section>

				<section>
					<h2>Tree</h2>
					<pre><code class="shell" data-noescape><span class="line-nohl">$ git cat-file -p 755a33e4667848c71d2ebde4bf1cd8eb2a36a1dd</span>
<span class="line-nohl">100644 blob 1620d5c9c4d3102beb552bc2db496482924386ea    .gitignore</span>
<span class="line-nohl">100644 blob ddbcba4eaa1b925df086b3cff71104a1ff8c7a84    .gitlab-ci.yml</span>
<span class="line-nohl">100644 blob 4be17156977c770957b6cb883b817108296ee2f9    Dockerfile</span>
<span class="line-nohl">100644 blob a2071fb01a5cbf65c54bb612ef34a37c8da2d30b    README.md</span>
<span class="line-nohl">100755 blob ed0ab79cbb584975a4611304a7a7acbc437f294f    build-manifests.sh</span>
<span class="line-nohl">100644 blob d03cd079f4ee07ff12f96fcd43c07e98daa904f1    build.sbt</span>
<span>040000 tree 9c0dd50454bf7d9b564b6dce3ff2955ef6fc2e29    manifests</span>
<span class="line-nohl">040000 tree 4671c32b75507ef0fcb13680bdf47cba159f1e87    project</span>
<span class="line-nohl">100755 blob 0d950f32340f72a3b0bd4d0ce9ce273821f3d910    publish-manifests-bundle.sh</span>
<span class="line-nohl">040000 tree 45d3bf59ab21d045f636548aea929b705207d759    src</span></code></pre>
				</section>

				<section>
					<h2>Tree</h2>
					<pre><code class="shell">$ git cat-file -p 9c0dd50454bf7d9b564b6dce3ff2955ef6fc2e29
100644 blob 998972a0dae5b3244420cd47390410a254d76631    reportingdummyconsumer-00-namespace.yaml
100644 blob 08deec78f31bb6542d3a8879d1aa3525611269ac    reportingdummyconsumer-01-config.yaml
100644 blob a9fbeee93afc7f4acc5220a46f4b952d201d5b7b    reportingdummyconsumer-02-deployment.yaml
100644 blob 7ea859116d8d8c3a9e760bead27fa701a41da858    reportingdummyconsumer-06-service.yaml</code></pre>
				</section>

				<section>
					<h2>Commit</h2>
					<p>Holds the metadata of a repository change</p>
					<ul>
						<li>Author and authored date</li>
						<li>Commiter and commited date</li>
						<li>Directory structure — a tree object</li>
						<li>Parent commit(s)</li>
					</ul>
				</section>

				<section>
					<h2>Commit</h2>
					<pre><code class="shell">$ git cat-file -p 5e1d5da8cb59b3e744d5d5393e712f23edec7808
tree 87010a065cdd7d2bdaeff3a1464cc066f6bdacd0
parent b821d8780843f61051c705928ffc860606ff5c32
author Zdravko Stoychev &lt;z.stoychev@ocado.com&gt; 1552054709 +0200
committer Zdravko Stoychev &lt;z.stoychev@ocado.com&gt; 1552054709 +0200

Fix gitlab CI tags</code></pre>
				</section>

				<section>
					<h2>Commit</h2>
					<pre><code class="shell">$ git cat-file -p b30543def78e0a3aafbd0be071868e5395e83007
tree 755a33e4667848c71d2ebde4bf1cd8eb2a36a1dd
parent 5e1d5da8cb59b3e744d5d5393e712f23edec7808
parent 1bf24ac0cb70b05b2c70ce5a15270fc51632f157
author Zdravko Stoychev &lt;z.stoychev@ocado.com&gt; 1552322402 +0200
committer Zdravko Stoychev &lt;z.stoychev@ocado.com&gt; 1552322402 +0200

Merge branch 'k8s-setup'</code></pre>
				</section>

				<section>
					<h2>Tag</h2>
					<ul>
						<li>A reference to a specific object, usually a commit</li>
						<li>Annotated and lighweight</li>
					</ul>

				</section>

				<section>
					<h2>Tag</h2>
					<pre><code class="shell">$ git cat-file -p v0.1
object b30543def78e0a3aafbd0be071868e5395e83007
type commit
tag v0.1
tagger Zdravko Stoychev &lt;z.stoychev@ocado.com&gt; 1553694627 +0200

Release v0.1</code></pre>
				</section>

				<section>
					<h2>Refs</h2>

					<ul>
						<li>Branches – a builder for history</li>
						<li>Tags (lightweight and annotated)</li>
						<li><code>HEAD</code> – points to the current branch/commit.<br />This is local and is not shared with other repository clones</li>
					</ul>

					<p class="fragment">
						Branches, <code>HEAD</code> and the index are <span class="details">(almost)</span> the only mutable data<br />
						that is stored in the repo<br />
						<span class="fragment">(and they work together)</span>
					</p>
				</section>

				<section>
					<h2>Index</h2>

					<pre><code class="shell">$ git ls-files -s
100644 1620d5c9c4d3102beb552bc2db496482924386ea 0       .gitignore
100644 ddbcba4eaa1b925df086b3cff71104a1ff8c7a84 0       .gitlab-ci.yml
100644 4be17156977c770957b6cb883b817108296ee2f9 0       Dockerfile
100644 a2071fb01a5cbf65c54bb612ef34a37c8da2d30b 0       README.md
100755 ed0ab79cbb584975a4611304a7a7acbc437f294f 0       build-manifests.sh
100644 d03cd079f4ee07ff12f96fcd43c07e98daa904f1 0       build.sbt
100644 998972a0dae5b3244420cd47390410a254d76631 0       manifests/reportingdummyconsumer-00-namespace.yaml
100644 08deec78f31bb6542d3a8879d1aa3525611269ac 0       manifests/reportingdummyconsumer-01-config.yaml
100644 a9fbeee93afc7f4acc5220a46f4b952d201d5b7b 0       manifests/reportingdummyconsumer-02-deployment.yaml
100644 7ea859116d8d8c3a9e760bead27fa701a41da858 0       manifests/reportingdummyconsumer-06-service.yaml
100644 45a71bdbe258baccae6592ec526cda40491b0abd 0       project/build.properties
100644 cc9a881cbc5c19f3874f9690e9026241d3719843 0       project/plugins.sbt
100755 0d950f32340f72a3b0bd4d0ce9ce273821f3d910 0       publish-manifests-bundle.sh
100644 57a09972bd1606d75f1f82ed62aa2c339c1f142e 0       src/main/resources/application.conf
100644 52d28b1bf17e7e8d8265f076be523625fc7c0c16 0       src/main/resources/logback.xml
100644 48a1b5e1deefe8bb17fd22024902a0a26d497de7 0       src/main/scala/com/ocado/reporting/dummyconsumer/DummyEventsConsumerApp.scala
100644 e237ffa922054a28c02694f1c3aa25e5d56dc802 0       src/main/scala/com/ocado/reporting/dummyconsumer/routes/Healthcheck.scala
100644 068fbf108354099fd1a6a1880ad58e6f1a7aa37d 0       src/main/scala/com/ocado/reporting/dummyconsumer/routes/LoggingConsumer.scala
100644 9cfe157ef226ff3ae5da33b2a38e8dbbd131aa65 0       src/main/scala/com/ocado/reporting/dummyconsumer/utils/JsonMarshalling.scala</code></pre>
				</section>

				<section>
					<h2>Objects Demo</h2>
				</section>

				<section>
					<p><img src="images/httpatomoreillycomsourceoreillyimages1286900.png" alt="" /></p>
				</section>

				<section>
					<p><img src="images/httpatomoreillycomsourceoreillyimages1286902.png" height="640" alt="" /></p>
				</section>

				<section>
					<p><img src="images/httpatomoreillycomsourceoreillyimages1286916.png.jpg" alt="" /></p>
				</section>

				<section>
					<p>Git has low-level tools for managing the repository content</p>
				</section>

				<section>
					<p>Everything else is a (configurable) tooling<br />built upon this foundation</p>

					<p class="fragment">A version control system on top of content tracking system</p>

					<!--<p class="fragment">The diffs that the diff, merge, log, etc, tools find are coming from these tools,<br />not from the internal format</p>-->
				</section>

				<section>
					<h2>Showing/Analysing<br />Repository Content</h2>

					<ul>
						<li><code>git show</code></li>
						<li><code>git cat-file</code></li>
						<li><code>git diff</code> <span class="refs">[
							<a href="https://stackoverflow.com/questions/4045017/what-is-git-diff-patience-for/36551123">1</a>,
							<a href="http://fabiensanglard.net/git_code_review/diff.php">2</a>,
							<a href="https://cdn-images-1.medium.com/max/1600/1*QC68ca9DyLOlLkc2bYBZiA.png">3</a>,
							<a href="https://github.com/andreyvit/json-diff">4</a>,
							<a href="https://www.viget.com/articles/dress-up-your-git-diffs-with-word-level-highlights/">5</a>,
							<a href="https://github.com/so-fancy/diff-so-fancy">6</a>
						]</span>
						</li>
						<li><code>git log</code></li>
						<li><code>git blame</code></li>
						<li><code>git grep</code></li>
					</ul>

					<p class="fragment">Git doesn't track renames. It infers them (with a probability)</p>
					<p class="fragment">Git is efficient in tracing history for both directories and files<br />(Thanks to its model)</p>
					<p class="fragment">Git tracks content</p>
				</section>

				<section>
					<h2><code>git blame</code></h2>

					<p>FromDigits.scala</p>
					<pre><code class="scala">package util

import scala.annotation.tailrec

def fromDigits(digits: List[Int], radix: Int = 10): Int = {
  @tailrec
  def fromDigits(digits: List[Int], acc: Int): Int = {
    if (digits.isEmpty) acc
    else fromDigits(digits.tail, acc * radix + digits.head)
  }

  fromDigits(digits, 0)
}</code></pre>

					<p>ParseInteger.scala</p>
					<pre><code class="scala">package util

def parseInteger(integer: String, radix: Int = 10): Int = {
  if (integer.nonEmpty && integer.head == '-') -parseInteger(integer.tail, radix)
  else fromDigits(integer.map(_.asDigit).toList, radix)
}</code></pre>
				</section>

				<section>
					<h2><code>git blame</code></h2>
					<p>IntegerUtils.scala (in newer commit)</p>
					<pre><code class="scala">package util

import scala.annotation.tailrec

def fromDigits(digits: List[Int], radix: Int = 10): Int = {
  @tailrec
  def fromDigits(digits: List[Int], acc: Int): Int = {
    if (digits.isEmpty) acc
    else fromDigits(digits.tail, acc * radix + digits.head)
  }

  fromDigits(digits, 0)
}

def parseInteger(integer: String, radix: Int = 10): Int = {
  if (integer.nonEmpty && integer.head == '-') -parseInteger(integer.tail, radix)
  else fromDigits(integer.map(_.asDigit).toList, radix)
}</code></pre>
				</section>

				<section>
					<h2><code>git blame</code></h2>
					<p><code>git blame IntegerUtils.scala</code></p>
					<pre><code class="shell">^32959f4 FromDigits.scala    1) package util
^32959f4 FromDigits.scala    2)
^32959f4 FromDigits.scala    3) import scala.annotation.tailrec
^32959f4 FromDigits.scala    4)
^32959f4 FromDigits.scala    5) def fromDigits(digits: List[Int], radix: Int = 10): Int = {
^32959f4 FromDigits.scala    6)   @tailrec
^32959f4 FromDigits.scala    7)   def fromDigits(digits: List[Int], acc: Int): Int = {
^32959f4 FromDigits.scala    8)     if (digits.isEmpty) acc
^32959f4 FromDigits.scala    9)     else fromDigits(digits.tail, acc * radix + digits.head)
^32959f4 FromDigits.scala   10)   }
^32959f4 FromDigits.scala   11)
^32959f4 FromDigits.scala   12)   fromDigits(digits, 0)
^32959f4 FromDigits.scala   13) }
31e1fe0b IntegerUtils.scala 14)
31e1fe0b IntegerUtils.scala 15) def parseInteger(integer: String, radix: Int = 10): Int = {
31e1fe0b IntegerUtils.scala 16)   if (integer.nonEmpty && integer.head == '-') -parseInteger(integer.tail, radix)
31e1fe0b IntegerUtils.scala 17)   else fromDigits(integer.map(_.asDigit).toList, radix)
31e1fe0b IntegerUtils.scala 18) }</code></pre>
				</section>

				<section>
					<h2><code>git blame</code></h2>
					<p><code>git blame -C IntegerUtils.scala</code></p>
					<pre><code class="shell">^32959f4 FromDigits.scala    1) package util
^32959f4 FromDigits.scala    2)
^32959f4 FromDigits.scala    3) import scala.annotation.tailrec
^32959f4 FromDigits.scala    4)
^32959f4 FromDigits.scala    5) def fromDigits(digits: List[Int], radix: Int = 10): Int = {
^32959f4 FromDigits.scala    6)   @tailrec
^32959f4 FromDigits.scala    7)   def fromDigits(digits: List[Int], acc: Int): Int = {
^32959f4 FromDigits.scala    8)     if (digits.isEmpty) acc
^32959f4 FromDigits.scala    9)     else fromDigits(digits.tail, acc * radix + digits.head)
^32959f4 FromDigits.scala   10)   }
^32959f4 FromDigits.scala   11)
^32959f4 FromDigits.scala   12)   fromDigits(digits, 0)
^32959f4 FromDigits.scala   13) }
^32959f4 ParseInteger.scala 14)
^32959f4 ParseInteger.scala 15) def parseInteger(integer: String, radix: Int = 10): Int = {
^32959f4 ParseInteger.scala 16)   if (integer.nonEmpty && integer.head == '-') -parseInteger(integer.tail, radix)
^32959f4 ParseInteger.scala 17)   else fromDigits(integer.map(_.asDigit).toList, radix)
^32959f4 ParseInteger.scala 18) }
</code></pre>
				</section>

				<section>
					<h2><code>git blame</code></h2>
					<ul>
						<li><code>git blame &lt;file&gt;</code></li>
						<li><code>git blame -w &lt;file&gt;</code> — ignore whitespace</li>
						<li><code>git blame -M &lt;file&gt;</code> — detect moved lines within a files</li>
						<li><code>git blame -C &lt;file&gt;</code> — detect moved or copied lines from other files in the same commit</li>
						<li class="fragment"><code>git blame -CC &lt;file&gt;</code> — additionally in other files in the commit that created that file</li>
						<li class="fragment"><code>git blame -CCC &lt;file&gt;</code> — additionally in other files in any commit</li>
					</ul>
				</section>

				<section>
					<h2>Searching for a Snippet’s History</h2>

					<p class="fragment">What if someone else updated the line and you are interested in<br />only part of it?</p>

					<div class="fragment">
						<p>Use “pickaxe”:</p>

						<pre><code class="shell">$ git log -S &lt;string&gt; [path-to-look-in]</code></pre>

						<p class="fragment">The <code>string</code> can be a snippet from a line or even a multiline block of code.</p>
					</div>
				</section>

				<section>
					<h2>Referencing Objects</h2>

					<ul>
						<li>Object’s hash — <code>eed89a6588c0452</code></li>
						<li>Tags</li>
					</ul>
				</section>

				<section>
					<h2>Referencing Commits</h2>
					<ul>
						<li class="fragment">Commit’s hash — <code>eed89a6588c0452</code></li>
						<li class="fragment">
							Named refs — branches, tags

							<ul>
								<li><code>master</code></li>
								<li><code>origin/master</code></li>
								<li><code>v2.72</code></li>
							</ul>
						</li>
						<li class="fragment">Special names
							<ul>
								<li><code>HEAD</code> — the checkouted commit (or the most recent commit on the current branch)</li>
								<li><code>ORIG_HEAD</code> — the state of HEAD before certain operations like merge, reset, etc.</li>
								<li><code>FETCH_HEAD</code> — the head of the last fetched branch (after git fetch)</li>
								<li><code>MERGE_HEAD</code> — the tip of the other branch, when a merge is in progress</li>
							</ul>
						</li>
					</ul>
				</section>

				<section>
					<h2>Referencing Commits</h2>

					<p>Upstream:</p>

					<ul>
						<li><code>@{u}</code> – the upstream branch of <code>HEAD</code></li>
						<li><code>develop@{u}</code> – the upstream branch of <code>develop</code></li>
						<!--<li><code>:/&lt;text&gt;</code> – first commit containing <code>text</code> in its message</li>-->
					</ul>
				</section>

				<section>
					<h2>Referencing Commits</h2>

					<p>Relative names:</p>

					<ul>
						<li><code>HEAD~2</code></li>
						<li><code>HEAD^</code></li>
						<li><code>master~3^2~</code></li>
					</ul>

					<p><img src="images/httpatomoreillycomsourceoreillyimages1286914.png" alt="" /></p>
				</section>

				<section>
					<h2>Referencing Commits</h2>

					<p>From the log:</p>

					<ul>
						<li><code>develop@{4}</code><br />– the 4th prior value for <code>develop</code> (locally)</li>
						<li><code>HEAD@{5}</code><br />– the 5th prior value for <code>HEAD</code></li>
						<li><code>develop@{yesterday}</code></li>
						<li><code>develop@{last Monday}</code></li>
						<li><code>develop@{3 hours ago}</code></li>
						<li><code>HEAD@{yesterday}</code></li>
					</ul>

					<p class="fragment"><code>git reflog</code> demo</p>
				</section>

				<section>
					<h2>Commit Ranges</h2>
					<ul>
						<li><code>start..end</code> — the set of commits reachable from <code>end</code> that are not reachable from <code>start</code>.</li>
						<li class="fragment">e.g. <code>master..origin/master</code> – the commits from <code>origin/master</code> that are not yet merged into <code>master</code></li>
						<li class="fragment"><code>master...develop</code> — the symmetric difference between the commits</li>
						<li class="fragment"><code>git log X</code> – all commits reachable from <code>X</code></li>
						<li class="fragment"><code>git log ^X</code> – ignore commits reachable from <code>X</code></li>
						<li class="fragment"><code>git log ^develop ^topic master</code></li>
					</ul>
				</section>

				<section>
					<h2>Referencing blobs</h2>

					<p><code>git show &lt;commit&gt;:&lt;file&gt;</code></p>
				</section>

				<section>
					<h2>Referencing files (for some commands)</h2>

					<ul>
						<li><code>git log &lt;commit&gt; -- &lt;file&gt;</code></li>
						<li><code>git checkout &lt;commit&gt; -- &lt;file&gt;</code></li>
					</ul>
				</section>

				<section>
					<h2>Managing</h2>

					<ul>
						<li>the working directory</li>
						<li>the index</li>
						<li>the current branch</li>
					</ul>
				</section>

				<section>
					<h2>Managing the Working Directory<br />&amp; What <code>HEAD</code> Points To</h2>

					<ul>
						<li class="fragment">Just update the files</li>
						<li class="fragment">
							<code>git checkout</code>

							<ul>
								<li class="fragment">switch <code>HEAD</code> to a branch/commit, <strong class="fragment">and/or</strong></li>
								<li class="fragment">restore files from index/a ref</li>
							</ul>
						</li>
						<li class="fragment"><code>git checkout &lt;ref&gt;</code> — update <code>HEAD</code>, the index and the working directory to match that ref</li>
						<li class="fragment">Switching <code>HEAD</code> would never allow you to lose changes in the working directory</li>
						<li class="fragment"><code>git checkout -b &lt;branch-name&gt; [ref]</code> — create new branch from <code>ref</code> (or <code>HEAD</code>) and checkout it</li>
						<li class="fragment"><code>git checkout [ref] &lt;paths&gt;</code> — retrieve a file from the index/the ref</li>
						<li class="fragment"><code>git clean -f -d</code></li>
					</ul>
				</section>

				<section>
					<h2>Managing the Index</h2>
					<ul>
						<li>
							<code>git add &lt;filepattern&gt;</code>
							<ul>
								<li><code>git add -p [filepattern]</code> – adding patches</li>
								<li><code>git add -i [filepattern]</code> – interactive add</li>
							</ul>
						</li>
						<li class="fragment"><code>filepattern</code> — <code>'*.java', 'a/bc/d/*.xml'</code></li>
						<li class="fragment">
							<code>git rm &lt;filepattern&gt;</code><br />
							<!--<span class="fragment">==<br/><code>rm &lt;filepattern&gt;<br />git add &lt;filepattern&gt;</code></span>-->
						</li>
						<li class="fragment">
							<code>git mv &lt;source&gt; &lt;destination&gt;</code><br />
							<!--<span class="fragment">==<br/><code>-->
								<!--mv &lt;source&gt;  &lt;destination&gt;<br />-->
								<!--git add &lt;source&gt; &lt;destination&gt;-->
							<!--</code></span>-->
						</li>
					</ul>
				</section>

				<section>
					<h2>Managing the Index</h2>

					<h3>File classification</h3>

					<ul>
						<li>Tracked</li>
						<li>Ignored</li>
						<li>Untracked</li>
					</ul>
				</section>

				<section>
					<h2>Managing the Current Branch</h2>

					<ul>
						<li><code>git commit</code><br /> – new commit from the index</li>
						<li><code>git commit --amend</code><br /> – copy of the last commit with the current index</li>
						<li><code>git reset</code></li>
						<li><code>git merge</code></li>
						<li><code>git cherry-pick</code></li>
						<li><code>git revert</code></li>
						<li><code>git rebase</code></li>
					</ul>
				</section>

				<section>
					<h2><code>git commit</code></h2>

					<p class="fragment">What happens?</p>
				</section>

				<section>
					<h2>Commit Messages</h2>

					<p class="fragment"><a href="https://chris.beams.io/posts/git-commit/">How to Write a Git Commit Message</a></p>
				</section>

				<section>
					<h2>Commit Messages</h2>

					<pre><code>Summarize changes in around 50 characters or less

More detailed explanatory text, if necessary. Wrap it to about 72
characters or so. In some contexts, the first line is treated as the
subject of the commit and the rest of the text as the body. The
blank line separating the summary from the body is critical (unless
you omit the body entirely); various tools like `log`, `shortlog`
and `rebase` can get confused if you run the two together.

Explain the problem that this commit is solving. Focus on why you
are making this change as opposed to how (the code explains that).
Are there side effects or other unintuitive consequences of this
change? Here's the place to explain them.

Further paragraphs come after blank lines.

 - Bullet points are okay, too

 - Typically a hyphen or asterisk is used for the bullet, preceded
   by a single space, with blank lines in between, but conventions
   vary here

If you use an issue tracker, put references to them at the bottom,
like this:

Resolves: #123
See also: #456, #789</code></pre>
				</section>

				<section>
					<h2>Commit Messages</h2>

					<ol>
						<li>Separate subject from body with a blank line</li>
						<li>Limit the subject line to 50 characters</li>
						<li>Capitalize the subject line</li>
						<li>Do not end the subject line with a period</li>
						<li>
							Use the imperative mood in the subject line

							<ul>
								<li>If applied, this commit will &lt;subject-line&gt;</li>
							</ul>
						</li>
						<li>Wrap the body at 72 characters</li>
						<li>Use the body to explain what and why vs. how</li>
					</ol>
				</section>

				<section>
					<p>Git already provides such style of messages for its operations — merge, revert, etc</p>

					<pre><code>Merge branch 'k8s-setup'</code></pre>
					<pre><code>Merge branch 'cool-new-feature' into develop</code></pre>
				</section>

				<section>
					<h2>Changing the Last Commit</h2>

					<p><code>git commit --amend</code></p>
				</section>

				<section>
					<h2>Changing to a Known State</h2>

					<ul>
						<li><code>git reset --soft [commit]</code>
							<ul>
								<li>points the current branch to that commit</li>
							</ul>
						</li>
						<li class="fragment"><code>git reset --mixed [commit]</code> (the default)
							<ul>
								<li>points the current branch to that commit</li>
								<li>changes the index to the tree in that commit</li>
							</ul>
						</li>
						<li class="fragment"><code>git reset --hard [commit]</code>
							<ul>
								<li>points the current branch to that commit</li>
								<li>changes the index to the tree in that commit</li>
								<li>changes the state of the working directory to match that commit (untracked and ignored files are untouched)</li>
							</ul>
						</li>
					</ul>
				</section>

				<section>
					<h2>Merge</h2>
					<pre><code class="shell">$ git checkout branch
$ git merge other-branch</code></pre>
					<pre><code>Merge branch 'release/0.2.4' into develop

# Conflicts:
#    service/src/main/java/com/rivinet/service/domain/member/impl/MemberProfileInfoServiceImpl.java</code></pre>
				</section>

				<section>
					<h2>Merge Strategies</h2>
				</section>

				<section>
					<h2>Degenerate Merge Strategies</h2>
					<ul>
						<li>Already up-to-date</li>
						<li>Fast-forward (disallow with --no-ff)</li>
					</ul>
				</section>

				<section>
					<h2>Resolve Merge Strategy</h2>

					<p>Merges two branches into a merge commit.</p>

					<p><img src="images/basicmerge.png" alt="" />
				</section>

				<section>
					<h2>Resolve Merge Strategy</h2>

					<p>Git analyses the history of the two branches and:</p>

					<ul>
						<li class="fragment">If a file is updated or created in only one of the branches<br />– directly use it in the merge commit</li>
						<li class="fragment">If a file is updated in one of the branches and deleted in the other<br />– conflict</li>
						<li class="fragment">If a file is updated in both branches<br />– call the files’ <strong>merge driver</strong> (basically a diff tool)</li>
					</ul>

					<p class="fragment">By default git also detects file renames and correctly matches the file in the two branches</p>
				</section>

				<section>
					<h2>The Merge Driver?</h2>
				</section>

				<section>
					<h2>Two-Way Merge<br /><span class="fragment">– not used by Git</span></h2>

					<p class="fragment"><img src="images/figure-5.png" /></p>
				</section>

				<section>
					<h2>Three-Way Merge</h2>

					<p class="fragment">between the merge base version and the version in the two branches</p>

					<div class="fragment">
						<p>git automatically calls something like:</p>

						<pre><code class="shell">$ git merge-file &lt;ours-version&gt; &lt;base-version&gt; &lt;theirs-version&gt;</code></pre>

						<p class="fragment">The merging algorithm doesn't try to be sophisticated, but predictable instead.</p>
					</div>
				</section>

				<section>
					<h2>Three-Way Merge</h2>
					<p><img src="images/fearofmerging-figure-2.jpg" alt="" />
				</section>

				<section>
					<h2>The State After a Merge Conflict</h2>

					<p>For each conflicted file the index contains the merge base version, “ours” version and “theirs” version</p>

					<pre><code>$ git show :1:file.scala > file.base.scala
$ git show :2:file.scala > file.ours.scala
$ git show :3:file.scala > file.theirs.scala</code></pre>
				</section>

				<section>
					<h2>The State After a Merge Conflict</h2>

					<ul>
						<li>git log --merge --left-right -p</li>
						<li>git checkout --ours &lt;files&gt;</li>
						<li>git checkout --theirs &lt;files&gt;</li>
						<li>git merge --abort</li>
					</ul>
				</section>

				<section>
					<h2>Recursive Merge Strategy</h2>

					<p>The default. Minimizes conflicts</p>
				</section>

				<section>
					<h2>Recursive Merge Strategy</h2>

					<p><img src="images/recursivemergesample00.png" alt="" />
				</section>

				<section>
					<h2>Recursive Merge Strategy</h2>

					<p><img src="images/recursivemergesample01.png" alt="" />
				</section>

				<section>
					<h2>Other Merge Strategies</h2>

					<ul>
						<li>Octopus</li>
						<li>Ours</li>
						<li>Subtree</li>
						<li>Squash</li>
					</ul>
				</section>

				<section>
					<h2>Merge Tool</h2>

					<ul>
						<li>merge.tool config</li>
						<li>git mergetool <em>[file...]</em></li>
						<li>mergetool.keepBackup</li>
					</ul>
				</section>

				<section>
					<h2>Picking Individual Commits</h2>

					<ul>
						<li><code>git cherry-pick &lt;commit&gt;</code> — apply that commit to the current <code>HEAD</code> (and update the branch)</li>
						<li class="fragment"><code>git cherry-pick start^..end</code> — apply the commits in the range start^..end to the current <code>HEAD</code> (and update the branch)</li>
						<li class="fragment">Merge base for conflicts – the version in the parent of the cherry-picked commit</li>
					</ul>
				</section>

				<section>
					<h2>Reverting Commits</h2>
					<ul>
						<li><code>git revert &lt;commit&gt;</code> - creates a new commit that undoes the changes in the specified commit</li>
						<li><code>git revert start^..end</code> — for each commit in the range create a new commit that undoes it</li>
					</ul>
					<pre><code>Revert "Show the end screen when the video is paused"

This reverts commit f3db63c38b879deda3c8656df847fbb26a31c0ea.</code></pre>

					<ul>
						<li class="fragment">Merge base for conflicts is the commit itself, what's merged is it's parent commit</li>
					</ul>
				</section>

				<section>
					<h2>Reverting Merge Commits</h2>

					<pre><code> ---o---o---o---M---x---x
	       /
       ---A---B</code></pre>

					<p class="fragment">git revert -m 1 <em>M</em></p>

					<pre class="fragment"><code> ---o---o---o---M---x---x---W
	       /
       ---A---B</code></pre>

					<p class="fragment">What if now we want to merge the feature again?</p>

					<pre class="fragment"><code>$ git merge feature
Already up-to-date.</code></pre>
				</section>

				<section>
					<h2>Reverting Merge Commits</h2>

					<p>Fix the branch, revert the revert on merge</p>
					<pre><code> ---o---o---o---M---x---x---W---x
	       /
       ---A---B-------------------C---D</code></pre>
					<div class="fragment">
					<pre><code>$ git revert W
Finished one revert.
[master 268e243] Revert "Revert "Merge branch 'feature'""
 1 files changed, 2 insertions(+), 0 deletions(-)
$ git merge feature
Auto-merging test.txt
Merge made by recursive.
 test.txt |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)</code></pre>

					<pre><code> ---o---o---o---M---x---x---W---x---M'--*
	       /                       /
       ---A---B-------------------C---D</code></pre>
					</div>
				</section>

				<section>
					<h2>Reverting Merge Commits</h2>

					<p>Fix on a new branch</p>

					<pre><code>$ git checkout -b feature-prime
$ git revert W
...
$ git merge feature-prime</code></pre>

					<pre><code> ---o---o---o---M---x---x---W---x---x---x---*
	       /                 \         /
       ---A---B                   M'--C---D</code></pre>
				</section>

				<section>
					<h2>Reverting Merge Commits</h2>

					<p>Rebase the branch</p>

					<pre><code> ---o---o---o---M---x---x---W---x---x---x---x---*
	       /                 \             /
       ---A---B                   A'--B'--C---D</code></pre>
				</section>

				<section>
					<h2>Reverting Merge Commits</h2>

					<p>If a fix is quick enough you can also just fix the problem instead of reverting the whole merge</p>
				</section>

				<section>
					<h2>Rebasing Commits</h2>

					<p><img src="images/httpatomoreillycomsourceoreillyimages1286988.png" alt="" /></p>
					<pre><code>$ git checkout topic
$ git rebase master</code></pre>
					<p><img src="images/httpatomoreillycomsourceoreillyimages1286990.png" alt="" /></p>
				</section>

				<section>
					<h2>Rebasing Commits</h2>

					<p><img src="images/httpatomoreillycomsourceoreillyimages1286992.png" alt="" /></p>
					<pre><code>$ git rebase --onto master maint^ feature</code></pre>
					<p><img src="images/httpatomoreillycomsourceoreillyimages1286994.png" alt="" /></p>
				</section>

				<section>
					<h2>Rebasing Commits</h2>

					<ul>
						<li>The rebase operation creates new commits</li>
						<li class="fragment">To rebase you should have clean working directory</li>
						<li class="fragment">Each commit is merged one by one and when a conflict occures the rebase operation is paused</li>
						<li class="fragment"><code>git rebase --continue</code>,<br /><code>git rebase --abort</code>,<br /><code>git rebase --skip</code></li>
						<li class="fragment"><code>git rebase --rebase-merges</code></li>
						<!--<li>the default base commit is the upstream top commit</li>-->
					</ul>
				</section>

				<section>
					<h2>Rebasing Commits – Cleaning Up History</h2>

					<p>git rebase -i (demo)</p>
				</section>

				<section>
					<h2>Linus’ Wisdom</h2>
					<blockquote>I want clean history, but that really means (a) clean and (b) history.</blockquote>
				</section>

				<section>
					<h2>Linus’ Wisdom</h2>

					<blockquote>People can (and probably should) rebase their _private_ trees (their own
						work). That's a _cleanup_. But never other peoples code. That's a "destroy history"</blockquote>
				</section>

				<section>
					<h2>Linus’ Wisdom</h2>

					<blockquote>You must never EVER destroy other peoples history. You must not rebase
						commits other people did. Basically, if it doesn't have your sign-off
						on it, it's off limits: you can't rebase it, because it's not yours.</blockquote>
				</section>

				<section>
					<h2>Linus’ Wisdom</h2>

					<blockquote><p>Keep your own history readable<p>

<p>Some people do this by just working things out in their head first, and
not making mistakes. but that's very rare, and for the rest of us, we
use "git rebase" etc while we work on our problems.</p></blockquote>
				</section>

				<section>
					<h2>Linus’ Wisdom</h2>

					<blockquote><p>Don't expose your crap.</p>

						<p>This means: if you're still in the "git rebase" phase, you don't push
							it out. If it's not ready, you send patches around, or use private git
							trees (just as a "patch series replacement") that you don't tell the
							public at large about.</p></blockquote>
				</section>

				<section>
					<h2>Linus’ Wisdom</h2>

					<blockquote><p>Don't merge upstream code at random points.</p>

<p>You should _never_ pull my tree at random points (this was my biggest
issue with early git users - many developers would just pull my current
random tree-of-the-day into their development trees). It makes your
tree just a random mess of random development. Don't do it!</p></blockquote>
					<blockquote class="fragment">But if you want to sync up with major releases, do a

git pull linus-repo v2.6.29</blockquote>
				</section>

				<section>
					<h2>Aliases</h2>

					<pre><code>git config --global alias.ss "status -s"</code></pre>
					<pre class="fragment"><code>git config --global alias.grog 'log --graph --abbrev-commit --decorate --all --format=format:"%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(dim white) - %an%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n %C(white)%s%C(reset)"'</code></pre>
				</section>

				<section>
					<h2>git bisect</h2>
				</section>

				<section>
					<h2>git stash</h2>

					<ul class="fragment">
						<li>--keep-index</li>
						<li>--include-untracked (-u)</li>
						<li>--all</li>
					</ul>
				</section>

				<section>
					<h2>git describe</h2>
				</section>

				<section>
					<h2>git worktree</h2>
				</section>

				<section>
					<h2>Remote Repositories</h2>

					<ul>
						<li>git remote add &lt;remote&gt; &lt;uri&gt; – can add multiple remotes</li>
						<li class="fragment">git remote show &lt;remote&gt;</li>
						<li class="fragment">For each <code>branch</code> of &lt;remote&gt; a ref named <code>remote/branch</code> is created in the local repo</li>
						<li class="fragment">These are called <em>remote-tracking branches</em> and are created and updated on fetch</li>
					</ul>
				</section>

				<section>
					<h2>Remote Repositories</h2>
					<ul>
						<li>git clone &lt;uri&gt;
							<ul>
								<li>Creates an <em>origin</em> that points to the remote repo</li>
								<li>Fetches the branches and the objects from the remote</li>
								<li>Checkouts the master branch and sets it to track origin/master</li>
								<li class="fragment">--bare — the local repository doesn’t have working directory, index and HEAD. Appropriate for non-developer repositories</li>
							</ul>
						</li>
					</ul>
				</section>

				<section>
					<h2>Tracking branches</h2>

					<ul>
						<li>Local branches with a relation to an upstream branch</li>
						<li class="fragment">Created automatically with git checkout &lt;remote-branch-name&gt;</li>
						<li class="fragment">git push -u origin &lt;branch-name&gt;</li>
					</ul>
				</section>

				<section>
					<h2>Pushing</h2>

					<ul>
						<li>git push &lt;remote&gt; [&lt;local-branch&gt;:]&lt;remote-branch&gt;</li>
						<li class="fragment">git push – when on tracking branch</li>
						<li class="fragment">Works only if the remote branch can be fast-forwarded</li>
						<li class="fragment">push --force[-with-lease]</li>
					</ul>
				</section>

				<section>
					<h2>Working with remotes</h2>
					<ul>
						<li>git pull — git fetch + get merge FETCH_HEAD</li>
						<li>git pull --rebase — git fetch + git rebase FETCH_HEAD</li>
						<li>git pull --rebase=merges — git fetch + git rebase --rebase-merges FETCH_HEAD</li>
					</ul>
				</section>

				<section>
					<h2>Git Patches</h2>
				</section>

				<section>
					<h2>Git Attributes</h2>
				</section>

				<section>
					<h2>git submodule</h2>

					<ul class="fragment">
						<li>git submodule add &lt;remote&gt;</li>
						<li>git submodule init</li>
						<li>git submodule update</li>
						<li>git clone --recurse-submodules &lt;remote&gt;</li>
						<li>git diff --submodule</li>
						<li>git submodule update --remote</li>
					</ul>
				</section>

				<section>
					<h2>Workflows</h2>
				</section>

				<section>
					<h2>Continuous integration; <a href="https://guides.github.com/introduction/flow/">Github flow</a></h2>
					<p><img src="images/github-flow.png" alt="" /></p>
				</section>

				<section>
					<h2>Gitflow; release-based deployment</h2>
					<p><img src="images/gitflow-model.png" height="580" alt="" /></p>
				</section>

				<section>
					<h2>Release-based deployment alternatives</h2>
					<p><img src="images/releases-1.png" height="580" alt="" /></p>
				</section>

				<section>
					<h2>Release-based deployment alternatives</h2>
					<p><img src="images/releases-3.png" height="580" alt="" /></p>
				</section>

				<section>
					<h2>Release-based deployment alternatives</h2>
					<p><img src="images/releases-2.png" height="580" alt="" /></p>
				</section>

				<section>
					<h2>git.git workflow</h2>
					<ul>
						<li>Feature graduation
							<ul>
								<li>maint — tracks the commits that should go into the next “maintenance release”, i.e., update of the last released stable version;</li>
								<li>master — tracks the commits that should go into the next release;</li>
								<li>next — intended as a testing branch for topics being tested for stability for master.</li>
								<li>pu (proposed updates) — an integration branch for things that are not quite ready for inclusion yet.</li>
							</ul>
						</li>
						<li>Topic branches</li>
						<li><a href="https://www.kernel.org/pub/software/scm/git/docs/gitworkflows.html">https://www.kernel.org/pub/software/scm/git/docs/gitworkflows.html</a></li>
					</ul>
				</section>
		</div>

		<script src="reveal-js/lib/js/head.min.js"></script>
		<script src="reveal-js/js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				history: true,
				center: false,
				transition: "fade",

				dependencies: [
					{ src: 'reveal-js/plugin/markdown/marked.js' },
					{ src: 'reveal-js/plugin/markdown/markdown.js' },
					{ src: 'reveal-js/plugin/notes/notes.js', async: true },
					{ src: 'reveal-js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
